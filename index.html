<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kids Cloth Store â€” Catalog</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--accent:#007bff;--muted:#666}
    body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;background:#f7f7f7}
    header{background:var(--accent);color:#fff;padding:16px 20px;font-size:20px;display:flex;align-items:center;justify-content:space-between}
    .container{max-width:1100px;margin:18px auto;padding:0 12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#fff;border-radius:8px;padding:12px;box-shadow:0 1px 4px rgba(0,0,0,0.08);display:flex;flex-direction:column}
    .card img{width:100%;height:200px;object-fit:cover;border-radius:6px}
    .card h4{margin:10px 0 6px;font-size:16px}
    .price{font-weight:700;margin-bottom:8px;color:var(--accent)}
    .btn{background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:6px;cursor:pointer}
    .controls{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:12px 0}
    .loadMoreWrap{text-align:center;margin:18px 0}
    .cartPanel{position:fixed;right:16px;top:80px;width:300px;background:#fff;border-radius:8px;padding:12px;box-shadow:0 4px 18px rgba(0,0,0,0.12)}
    .cartItem{display:flex;justify-content:space-between;margin-bottom:8px}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:900px){.cartPanel{position:static;width:auto;margin-top:12px}}
  </style>
</head>
<body>
  <header>
    <div>Kids Clothing Store</div>
    <div class="small">Showing clothes from <strong>kids.json</strong></div>
  </header>

  <div class="container">
    <div class="controls">
      <div>
        <label class="small">Items per page:
          <select id="pageSize">
            <option value="6">6</option>
            <option value="8">8</option>
            <option value="10" selected>10</option>
            <option value="12">12</option>
          </select>
        </label>
      </div>

      <div>
        <input id="searchInput" placeholder="Search name..." style="padding:8px;border-radius:6px;border:1px solid #ddd"/>
      </div>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>

    <div class="loadMoreWrap">
      <button id="loadMoreBtn" class="btn">Load More</button>
    </div>
  </div>

  <aside class="cartPanel" aria-label="Cart">
    <h3>ðŸ›’ Cart</h3>
    <div id="cartList"></div>
    <hr>
    <div style="display:flex;justify-content:space-between">
      <strong>Total</strong>
      <strong>â‚¹ <span id="total">0</span></strong>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button id="clearCart" class="btn" style="flex:1;background:#dc3545">Clear</button>
      <button id="checkout" class="btn" style="flex:1">Checkout</button>
    </div>
  </aside>

<script>
(async function(){
  // config
  const JSON_FILE = 'kids.json';   // ensure this file is next to index.html
  let allItems = [];
  let filtered = [];
  let currentPage = 0;
  let pageSize = parseInt(document.getElementById('pageSize').value,10);
  const grid = document.getElementById('grid');
  const loadMoreBtn = document.getElementById('loadMoreBtn');

  // CART (saved to localStorage)
  const CART_KEY = 'kids_store_cart_v1';
  let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');

  function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); renderCart(); }

  function addToCart(item){
    const existing = cart.find(x=>x.id===item.id);
    if(existing){ existing.qty += 1; }
    else{ cart.push({...item, qty:1}); }
    saveCart();
  }

  function removeFromCart(id){
    cart = cart.filter(i=>i.id!==id);
    saveCart();
  }

  function changeQty(id, delta){
    const it = cart.find(i=>i.id===id);
    if(!it) return;
    it.qty += delta;
    if(it.qty <= 0) removeFromCart(id);
    saveCart();
  }

  function renderCart(){
    const container = document.getElementById('cartList');
    container.innerHTML = '';
    let total = 0;
    if(cart.length === 0){ container.innerHTML = '<div class="small">Cart is empty</div>'; }
    cart.forEach(i=>{
      const row = document.createElement('div');
      row.className = 'cartItem';
      row.innerHTML = `
        <div style="flex:1">
          <div style="font-weight:600">${i.name}</div>
          <div class="small">â‚¹ ${i.price} Ã— ${i.qty}</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
          <button onclick="changeQtyLocal('${i.id}',1)" class="small btn" style="padding:6px 6px">+</button>
          <button onclick="changeQtyLocal('${i.id}',-1)" class="small btn" style="padding:6px 6px">-</button>
        </div>
      `;
      container.appendChild(row);
      total += i.price * i.qty;
    });
    document.getElementById('total').innerText = total;
  }

  // expose small helpers to buttons in cart (they call global functions)
  window.changeQtyLocal = function(id,delta){ changeQty(id,delta); };
  window.removeFromCartLocal = function(id){ removeFromCart(id); };

  // fetch JSON
  try {
    const resp = await fetch(JSON_FILE);
    if(!resp.ok) throw new Error('Failed to fetch ' + JSON_FILE + ': ' + resp.status);
    allItems = await resp.json();
    // default filtered = all
    filtered = [...allItems];
    renderPageReset();
  } catch(err){
    grid.innerHTML = `<div style="grid-column:1/-1;color:#c00">Error loading ${JSON_FILE}: ${err.message}</div>`;
    console.error(err);
  }

  // rendering functions
  function renderItems(items){
    const frag = document.createDocumentFragment();
    items.forEach(item=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${item.image}" alt="${escapeHtml(item.name)}" />
        <h4>${escapeHtml(item.name)}</h4>
        <div class="small">Age: ${item.ageRange} | Size: ${item.size}</div>
        <div class="price">â‚¹ ${item.price}</div>
        <div class="small">${escapeHtml(item.desc)}</div>
        <div style="margin-top:auto;display:flex;gap:8px;justify-content:flex-end">
          <button class="btn" onclick='addToCartFromBtn("${item.id}")'>Add to Cart</button>
        </div>
      `;
      frag.appendChild(card);
    });
    grid.appendChild(frag);
  }

  // safe helper
  function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // Add to cart by id
  window.addToCartFromBtn = function(id){
    const item = allItems.find(x=>x.id === id);
    if(!item){ alert('Item not found'); return; }
    addToCart(item);
  };

  // pagination logic
  function renderPageReset(){
    currentPage = 0;
    grid.innerHTML = '';
    renderNextPage();
    renderCart();
  }

  function renderNextPage(){
    const start = currentPage * pageSize;
    const end = start + pageSize;
    const pageItems = filtered.slice(start,end);
    renderItems(pageItems);
    currentPage++;
    // hide load more if no more items
    if(currentPage * pageSize >= filtered.length){
      loadMoreBtn.style.display = 'none';
    } else {
      loadMoreBtn.style.display = 'inline-block';
    }
  }

  // user actions
  loadMoreBtn.addEventListener('click', ()=> renderNextPage());
  document.getElementById('pageSize').addEventListener('change', (e)=>{
    pageSize = parseInt(e.target.value,10);
    renderPageReset();
  });

  // search filter
  document.getElementById('searchInput').addEventListener('input', (e)=>{
    const q = e.target.value.trim().toLowerCase();
    filtered = allItems.filter(i => i.name.toLowerCase().includes(q) || i.desc.toLowerCase().includes(q));
    renderPageReset();
  });

  // clear and checkout
  document.getElementById('clearCart').addEventListener('click', ()=>{
    if(confirm('Clear cart?')) { cart = []; saveCart(); }
  });

  document.getElementById('checkout').addEventListener('click', ()=>{
    if(cart.length === 0){ alert('Cart is empty'); return; }
    // simple checkout demo: show invoice summary and clear cart
    const total = cart.reduce((s,i)=>s + i.price * i.qty,0);
    const itemsSummary = cart.map(i => `${i.name} x ${i.qty} = â‚¹${i.price * i.qty}`).join('\n');
    alert(`Invoice\n\n${itemsSummary}\n\nTotal: â‚¹${total}\n\n(Checkout demo â€” no payment integrated)`);
    // optionally clear
    if(confirm('Clear cart after checkout?')) { cart = []; saveCart(); }
  });

  // initial cart load
  renderCart();

})();
</script>
</body>
</html>
