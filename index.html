<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kids Cloth Store ‚Äî Catalog</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- NOTE: you said you already include Bootstrap 4 and Font Awesome in project.
       This file assumes they exist. If not, add appropriate CDN links in the head. -->

  <style>
    :root{--accent:#007bff;--muted:#666;--header-bg:#f0f6ff}
    *{box-sizing:border-box}
    body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;background:#f7f7f7;color:#222}
    /* Header */
    header{background:var(--accent);color:#fff;padding:12px 20px;font-size:18px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .navbar-left{display:flex;align-items:center;gap:12px}
    .brand {font-weight:700;color:#fff;display:flex;align-items:center;gap:10px}
    .brand img{display:block;max-height:48px}
    .header-right{font-size:13px;color:#e8f3ff;display:flex;align-items:center;gap:12px}
    .cart-badge{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.12);padding:6px 10px;border-radius:18px;cursor:pointer}
    .cart-badge .count{background:#fff;color:var(--accent);font-weight:700;padding:2px 8px;border-radius:12px}
    .wishlist-badge{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.06);padding:6px 10px;border-radius:18px;cursor:pointer}
    .menuBar{background:#fff;border-bottom:1px solid #e6e6e6;padding:10px 20px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
    .menuBar a{color:#333;text-decoration:none;font-weight:600;cursor:pointer;padding:6px 8px;border-radius:4px}
    .menuBar a:hover{background:#f3f6ff}
    .container{max-width:1100px;margin:18px auto;padding:0 12px}
    .controls{display:flex;gap:12px;align-items:center;justify-content:space-between;margin:12px 0;flex-wrap:wrap}
    .controls .left{display:flex;gap:12px;align-items:center}
    .controls input[type="search"]{padding:8px;border-radius:6px;border:1px solid #ddd}
    select{padding:6px;border-radius:6px;border:1px solid #ddd}
    .sectionHeader{background:linear-gradient(90deg,#e9f1ff, #f7fbff);padding:12px 16px;border-radius:6px;margin-top:20px;border:1px solid #e3eefc;display:flex;align-items:center;justify-content:space-between;cursor:pointer}
    .sectionTitle{font-weight:700}
    .sectionBody{margin-top:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#fff;border-radius:8px;padding:12px;box-shadow:0 1px 6px rgba(0,0,0,0.06);display:flex;flex-direction:column;min-height:320px}
    .card img{width:100%;height:180px;object-fit:cover;border-radius:6px;background:#fafafa}
    .card h4{margin:10px 0 6px;font-size:16px}
    .price{font-weight:700;margin-bottom:8px;color:var(--accent)}
    .small{font-size:13px;color:var(--muted)}
    .btn{background:var(--accent);color:#fff;border:0;padding:8px 10px;border-radius:6px;cursor:pointer}
    .btn:focus{outline:3px solid rgba(0,123,255,0.2)}
    .addBtn.clicked{background:#28a745 !important} /* turns green after first click */
    .modalOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:1200}
    .modal{width:92%;max-width:760px;background:#fff;border-radius:8px;padding:18px;box-shadow:0 12px 40px rgba(0,0,0,0.25);max-height:90vh;overflow:auto}
    .modalHeader{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .closeBtn{background:#eee;border:0;padding:6px 10px;border-radius:6px;cursor:pointer}
    .cartTable{width:100%;border-collapse:collapse;margin-bottom:12px}
    .cartTable th, .cartTable td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .cartSummary{display:flex;justify-content:space-between;align-items:center;font-weight:700;margin-top:8px}
    .invoiceContent{padding:6px}
    .invoiceHeader{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .invoiceLogo{display:flex;align-items:center;gap:10px}
    .invoiceLogo img{max-height:56px}
    .invoiceTable{width:100%;border-collapse:collapse;margin-top:12px}
    .invoiceTable th, .invoiceTable td{padding:8px;border:1px solid #ddd;text-align:left}
    .invoiceTable th{background:#f5f7ff}
    footer{padding:20px;text-align:center;color:#666;border-top:1px solid #eee;margin-top:40px;background:#fff}
    @media(max-width:1024px){ .modal{width:94%} .card{min-height:280px} }
    @media(max-width:800px){ .grid{grid-template-columns:repeat(2,1fr)} .menuBar{padding:8px} }
    @media(max-width:520px){ .grid{grid-template-columns:repeat(1,1fr)} .container{padding:0 10px} }
    .muted{color:var(--muted);font-size:13px}
    .hidden{display:none}
    .section-wrap{margin-bottom:18px}
    .toggleSign{font-weight:700}
    @media print {
      body * { visibility: hidden; }
      .invoiceModal, .invoiceModal * { visibility: visible; }
      .invoiceModal { position: absolute; left: 0; top: 0; width: 100%; }
    }
    /* small helpers */
    .card-controls{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:10px}
    .sizeSelect{padding:6px;border-radius:6px;border:1px solid #ddd;background:#fff}
    .badge-inline{background:#f0f4ff;padding:4px 8px;border-radius:12px;font-weight:700;color:var(--accent);margin-left:8px}
    .tiny-note{font-size:12px;color:#888}
    /* hero */
    .hero{display:block;width:100%;max-height:300px;overflow:hidden;border-bottom:6px solid #f4f7ff}
    .hero img{width:100%;height:auto;display:block}
    .most-sold-section{margin-top:18px;padding:12px;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:8px;border:1px solid #e8f2ff}
  </style>
</head>
<body>

  <!-- HEADER / NAV -->
  <header>
    <div class="navbar-left">
      <!-- Logo (style B: logo + text side-by-side) -->
      <div class="brand" role="banner">
        <img src="logo.png" alt="Kids Store Logo" style="width:100px;height:auto;">
		<span style="font-size:20px">Kids Clothing Store</span>
      </div>
    </div>

    <div class="header-right" role="status" aria-live="polite">
      <div class="tiny-note">Showing clothes from <strong>kids.json</strong></div>

      <div class="wishlist-badge" id="headerWishlistBtn" title="Wishlist (0)">
        <i class="fa fa-heart"></i>
        <div id="headerWishlistCount" style="font-weight:700">0</div>
      </div>

      <div class="cart-badge" id="headerCartBtn" title="Cart (0)">
        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
        <div class="count" id="headerCartCount">0</div>
      </div>
    </div>
  </header>

  <!-- NAV LINKS -->
  <div class="menuBar" role="navigation" aria-label="Main menu">
    <a id="menuHome">Home</a>
    <a id="menuProducts">Products</a>
    <a id="menuContact">Contact</a>
    <a id="menuCart">Show Cart</a>
  </div>

  <!-- HERO / BANNER -->
 
  <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Auto Sliding Banner</title>
<style>
  

  body {
    margin: 0;
    font-family: sans-serif;
  }

  .hero {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .slides {
    display: flex;
    width: 5%; /* 3 banners */
    animation: slide 5s infinite;
  }

  .slides img {
    width: 100%;
    height: auto;
    flex-shrink: 0;
  }

  @keyframes slide {
  0%   { transform: translateX(0); }
  33%  { transform: translateX(-100%); }
  66%  { transform: translateX(-200%); }
  100% { transform: translateX(0); }
}


  
</style>
</head>
<body>

  <div class="hero">
    <div class="slides">
      <img src="Banner1.png" alt="Banner 1">
      <img src="Banner2.jpeg" alt="Banner 2">
	  <img src="Banner3.webp" alt="Banner 3">
	  <img src="Banner3.webp" alt="Banner 4">
	  <img src="Banner5.webp" alt="Banner 5">
	  <img src="Banner6.webp" alt="Banner 6">
	  
	  
     
    </div>
    <div class="dots">
      <span class="active"></span>
      <span></span>
      <span></span>
    </div>
  </div>

</body>
</html>


  <main class="container">
    <!-- Most Sold - placed under header as requested -->
    <section id="mostSold" class="most-sold-section" aria-labelledby="mostSoldTitle">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <h3 id="mostSoldTitle">‚≠ê Most Sold Products</h3>
        <div class="tiny-note">Top picks</div>
      </div>
      <div class="grid" id="mostSoldGrid" style="margin-top:12px"></div>
    </section>

    <!-- Controls -->
    <div class="controls" id="topControls" style="margin-top:18px">
      <div class="left">
        <label class="small">Items per page:
          <select id="pageSize" aria-label="Items per page">
            <option value="6">6</option>
            <option value="8">8</option>
            <option value="10" selected>10</option>
            <option value="12">12</option>
          </select>
        </label>
        <label class="small" style="margin-left:10px">Sort:
          <select id="sortBy" aria-label="Sort by">
            <option value="name" selected>Name A‚ÜíZ</option>
            <option value="price">Price Low‚ÜíHigh</option>
          </select>
        </label>
      </div>
      <div>
        <input id="searchInput" type="search" placeholder="Search name or description..." aria-label="Search items" />
      </div>
    </div>

    <div id="productsTop" style="height:1px"></div>

    <div id="sectionsContainer"></div>

    <div style="text-align:center;margin:18px 0">
      <button id="loadMoreBtn" class="btn" role="button" aria-label="Load more items">Load More</button>
    </div>
  </main>

  <!-- Cart Modal (centered) -->
  <div id="cartModalOverlay" class="modalOverlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document" aria-labelledby="cartTitle">
      <div class="modalHeader">
        <h2 id="cartTitle">üõí Cart</h2>
        <div>
          <button id="invoiceBtn" class="btn" style="margin-right:8px">Invoice</button>
          <button id="closeCartBtn" class="closeBtn">Close</button>
        </div>
      </div>

      <div id="cartContent">
        <table class="cartTable" id="cartTable">
          <thead>
            <tr><th>Item</th><th>Size</th><th>Qty</th><th>Price</th><th>Sub</th><th></th></tr>
          </thead>
          <tbody id="cartTbody"></tbody>
        </table>
        <div class="cartSummary">
          <div class="muted">Total</div>
          <div>‚Çπ <span id="modalTotal">0</span></div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
          <button id="modalClear" class="btn" style="background:#dc3545">Clear</button>
          <button id="modalCheckout" class="btn">Checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Wishlist Modal -->
  <div id="wishlistModalOverlay" class="modalOverlay" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="wishlistTitle">
      <div class="modalHeader">
        <h2 id="wishlistTitle">‚ô• Wishlist</h2>
        <div>
          <button id="closeWishlistBtn" class="closeBtn">Close</button>
        </div>
      </div>
      <div id="wishlistContent" style="padding:6px">
        <p class="muted">Your wishlist is empty.</p>
      </div>
    </div>
  </div>

  <!-- Invoice Modal (inside same page; used to print as PDF) -->
  <div id="invoiceModalOverlay" class="modalOverlay" aria-hidden="true">
    <div class="modal invoiceModal" role="document" aria-labelledby="invoiceTitle">
      <div class="modalHeader">
        <h2 id="invoiceTitle">Invoice</h2>
        <div>
          <button id="printInvoice" class="btn" style="margin-right:8px">Print</button>
          <button id="closeInvoice" class="closeBtn">Close</button>
        </div>
      </div>
      <div id="invoiceContent" class="invoiceContent">
        <!-- Populated dynamically; will include logo top-left -->
      </div>
    </div>
  </div>

  <footer id="contact">
    Email: support@kidstore.com | Phone: +91 99999 99999
  </footer>

<script>
(function () {
  'use strict';

  /* CONFIG */
  const JSON_FILE = 'kids.json';
  const MOST_SOLD_IDS = ['KID005', 'KID011', 'KID017', 'KID022', 'KID028', 'KID030']; // as provided
  const BASE_PATH = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
  const ORIGIN = window.location.origin;
  const BASE_URL = ORIGIN + BASE_PATH;
  const CATEGORIES = [
    { key: 'kids-1-3', title: 'Kids 1‚Äì3 Years', matcher: item => inRange(item.ageRange,1,3) },
    { key: 'kids-3-6', title: 'Kids 3‚Äì6 Years', matcher: item => inRange(item.ageRange,3,6) },
    { key: 'boys-5-10', title: 'Boys 5‚Äì10 Years', matcher: item => inRange(item.ageRange,5,10) && isBoy(item) },
    { key: 'girls-5-10', title: 'Girls 5‚Äì10 Years', matcher: item => inRange(item.ageRange,5,10) && isGirl(item) },
    { key: 'toys', title: 'Toys Section', matcher: item => isToy(item) }
  ];

  /* STATE */
  let allItems = [];
  let filtered = [];
  let shownCount = 0;
  let pageSize = parseInt(document.getElementById('pageSize').value,10) || 10;
  let cart = JSON.parse(localStorage.getItem('kids_store_cart_v1') || '[]'); // persists cart
  let wishlist = JSON.parse(localStorage.getItem('kids_store_wishlist_v1') || '[]'); // persists wishlist
  let invoiceSeq = parseInt(localStorage.getItem('invoice_seq') || '0', 10);

  /* In-memory click counters (reset on refresh) */
  const cartClickCounts = {};
  const lastClickTimestamps = {};

  /* DOM refs */
  const sectionsContainer = document.getElementById('sectionsContainer');
  const loadMoreBtn = document.getElementById('loadMoreBtn');
  const pageSizeSelect = document.getElementById('pageSize');
  const searchInput = document.getElementById('searchInput');
  const sortBySelect = document.getElementById('sortBy');
  const headerCartCount = document.getElementById('headerCartCount');
  const headerWishlistCount = document.getElementById('headerWishlistCount');
  const mostSoldGrid = document.getElementById('mostSoldGrid');

  /* Build category sections (preserve existing behavior) */
  const sectionMap = {};
  CATEGORIES.forEach(cat=>{
    const wrap = document.createElement('div');
    wrap.className = 'section-wrap';
    const header = document.createElement('div');
    header.className = 'sectionHeader';
    header.innerHTML = `<div class="sectionTitle">${cat.title}</div><div class="toggleSign">+</div>`;
    const body = document.createElement('div');
    body.className = 'sectionBody hidden';
    const grid = document.createElement('div');
    grid.className = 'grid';
    body.appendChild(grid);
    wrap.appendChild(header);
    wrap.appendChild(body);
    sectionsContainer.appendChild(wrap);
    sectionMap[cat.key] = { wrap, header, body, grid, title: cat.title };
    header.addEventListener('click', ()=>{
      const hidden = body.classList.contains('hidden');
      if(hidden){
        body.classList.remove('hidden');
        header.querySelector('.toggleSign').textContent = '‚àí';
        body.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } else {
        body.classList.add('hidden');
        header.querySelector('.toggleSign').textContent = '+';
      }
    });
  });

  /* ------------------------ Helpers ------------------------ */
  function parseRange(r){
    if(!r) return null;
    const m = String(r).match(/(\d+)\s*(?:-|to)?\s*(\d+)?/i);
    if(!m) return null;
    const a = parseInt(m[1],10);
    const b = m[2] ? parseInt(m[2],10) : a;
    return { min: a, max: b };
  }
  function inRange(ageRangeStr, low, high){
    const r = parseRange(ageRangeStr);
    if(!r) return false;
    return !(r.max < low || r.min > high);
  }
  function isBoy(item){
    const g = (item.gender || item.sex || '').toString().toLowerCase();
    return g.includes('boy') || g.includes('male') || false;
  }
  function isGirl(item){
    const g = (item.gender || item.sex || '').toString().toLowerCase();
    return g.includes('girl') || g.includes('female') || false;
  }
  function isToy(item){
    const t = (item.type || item.category || '').toString().toLowerCase();
    if(t.includes('toy')) return true;
    const n = (item.name||'').toLowerCase();
    return n.includes('toy') || n.includes('doll') || n.includes('puzzle') || n.includes('game') || n.includes('truck');
  }
  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  function resolveImage(itemImage){
    if(!itemImage) return BASE_URL + 'images/placeholder.png';
    const s = String(itemImage);
    if(s.startsWith('http://') || s.startsWith('https://') || s.startsWith('//')) return s;
    if(s.startsWith('/')) return ORIGIN + s;
    return BASE_URL + s;
  }
  function getCategoryKeyForItem(item){
    for(const cat of CATEGORIES){
      try { if(cat.matcher(item)) return cat.key; } catch(e){ }
    }
    return null;
  }
  function getSizesForItem(item){
    if(Array.isArray(item.sizes) && item.sizes.length) return item.sizes.slice();
    if(item.size) return [item.size];
    return ['S','M','L'];
  }
  function getPriceForSize(item, size){
    if(item.prices && typeof item.prices === 'object' && item.prices[size] != null) return Number(item.prices[size]);
    if(item.price != null) return Number(item.price);
    return 0;
  }
  function debounce(fn, wait){
    let t = null;
    return function(...args){
      if(t) clearTimeout(t);
      t = setTimeout(()=> { t = null; fn.apply(this,args); }, wait);
    };
  }

  /* ------------------------ Wishlist ------------------------ */
  function saveWishlist(){ localStorage.setItem('kids_store_wishlist_v1', JSON.stringify(wishlist)); renderWishlist(); }
  function toggleWishlist(item){
    const idx = wishlist.findIndex(i => i.id === item.id);
    if(idx === -1) wishlist.push({...item, addedAt: Date.now()});
    else wishlist.splice(idx,1);
    saveWishlist();
  }
  function renderWishlist(){
    const el = document.getElementById('wishlistContent');
    if(!el) return;
    el.innerHTML = '';
    if(wishlist.length === 0){
      el.innerHTML = `<p class="muted">Your wishlist is empty.</p>`;
      headerWishlistCount.textContent = '0';
      document.getElementById('headerWishlistBtn').title = 'Wishlist (0)';
      return;
    }
    headerWishlistCount.textContent = String(wishlist.length);
    document.getElementById('headerWishlistBtn').title = `Wishlist (${wishlist.length})`;
    wishlist.forEach(w => {
      const row = document.createElement('div');
      row.style.display = 'flex';
      row.style.gap = '8px';
      row.style.alignItems = 'center';
      row.style.marginBottom = '8px';
      row.innerHTML = `
        <img src="${resolveImage(w.image)}" alt="${escapeHtml(w.name)}" style="width:64px;height:48px;object-fit:cover;border-radius:6px">
        <div style="flex:1">
          <div style="font-weight:700">${escapeHtml(w.name)}</div>
          <div class="small">Size: ${escapeHtml(w.size || '')} ‚Ä¢ ‚Çπ ${w.price}</div>
        </div>
        <div>
          <button class="btn removeWishlist" data-id="${escapeHtml(w.id)}">Remove</button>
        </div>
      `;
      el.appendChild(row);
    });
    // attach remove handlers
    el.querySelectorAll('.removeWishlist').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-id');
        wishlist = wishlist.filter(x => x.id !== id);
        saveWishlist();
      });
    });
  }

  /* ------------------------ Cart functions ------------------------ */
  function saveCart(){ localStorage.setItem('kids_store_cart_v1', JSON.stringify(cart)); renderCart(); updateHeaderCartCount(); }
  function addToCart(item){
    const existing = cart.find(x=>x.id===item.id && x.size === item.size);
    if(existing) existing.qty += 1;
    else cart.push({ id: item.id, name: item.name, size: item.size, price: Number(item.price), image: item.image, desc: item.desc, qty: 1 });
    saveCart();
  }
  function changeQty(id, size, delta){
    const it = cart.find(i=>i.id===id && i.size === size);
    if(!it) return;
    it.qty += delta;
    if(it.qty <= 0) cart = cart.filter(x=>!(x.id===id && x.size===size));
    saveCart();
  }
  function removeFromCart(id, size){ cart = cart.filter(x=>!(x.id===id && x.size===size)); saveCart(); }

  function renderCart(){
    const tbody = document.getElementById('cartTbody');
    tbody.innerHTML = '';
    let total = 0;
    if(cart.length === 0){ tbody.innerHTML = `<tr><td colspan="6" class="muted">Cart is empty</td></tr>`; document.getElementById('modalTotal').textContent = 0; updateHeaderCartCount(); return; }
    cart.forEach(i=>{
      const tr = document.createElement('tr');
      const subtotal = (Number(i.price)||0) * (i.qty||0);
      tr.innerHTML = `<td>${escapeHtml(i.name)}</td><td>${escapeHtml(i.size)}</td><td>${i.qty}</td><td>‚Çπ ${i.price}</td><td>‚Çπ ${subtotal}</td>
        <td><button class="closeBtn smallRemove" data-id="${escapeHtml(i.id)}" data-size="${escapeHtml(i.size)}">Remove</button></td>`;
      tbody.appendChild(tr);
      total += subtotal;
    });
    // attach remove handlers
    tbody.querySelectorAll('.smallRemove').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        const id = btn.getAttribute('data-id');
        const size = btn.getAttribute('data-size');
        removeFromCart(id, size);
      });
    });
    document.getElementById('modalTotal').textContent = total;
    updateHeaderCartCount();
  }

  function updateHeaderCartCount(){
    const total = cart.reduce((s,i)=> s + (i.qty||0), 0);
    headerCartCount.textContent = String(total);
    document.getElementById('headerCartBtn').title = `Cart (${total})`;
  }

  /* ------------------------ Render product cards ------------------------ */
  function renderCardIntoSection(item){
    const key = getCategoryKeyForItem(item);
    if(!key) return;
    const section = sectionMap[key];
    if(!section) return;
    section.body.classList.remove('hidden');
    section.header.querySelector('.toggleSign').textContent = '‚àí';

    const sizes = getSizesForItem(item);
    const baseSize = sizes[0] || 'S';
    const basePrice = getPriceForSize(item, baseSize);

    const card = document.createElement('div');
    card.className = 'card';
    const imgSrc = resolveImage(item.image);

    card.innerHTML = `
      <img src="${imgSrc}" alt="${escapeHtml(item.name)}" loading="lazy" onerror="this.onerror=null;this.src='${BASE_URL}images/placeholder.png'"/>
      <h4>${escapeHtml(item.name)}</h4>
      <div class="small">Age: ${escapeHtml(item.ageRange||'')}</div>
      <div class="price" data-price="${basePrice}">‚Çπ ${basePrice}</div>
      <div class="small" style="margin-top:6px">${escapeHtml(item.desc||'')}</div>
      <div class="card-controls">
        <div>
          <label class="small">Size:
            <select class="sizeSelect" aria-label="Select size"></select>
          </label>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn addBtn" type="button" id="add-${escapeHtml(item.id)}"
            data-id="${escapeHtml(item.id)}"
            data-name="${escapeHtml(item.name)}"
            data-desc="${escapeHtml(item.desc||'')}"
            data-image="${escapeHtml(item.image||'')}"
          >Add to Cart</button>
          <button class="btn wishlistBtn" type="button" data-id="${escapeHtml(item.id)}" style="background:#fff;color:var(--accent);border:1px solid #ddd">‚ô°</button>
        </div>
      </div>
    `;

    section.grid.appendChild(card);

    // populate size select
    const sizeSelect = card.querySelector('.sizeSelect');
    sizes.forEach(sz=>{
      const opt = document.createElement('option');
      opt.value = sz;
      opt.text = sz;
      sizeSelect.appendChild(opt);
    });

    // set price display when size changes
    const priceEl = card.querySelector('.price');
    function updatePriceDisplayForSize(sz){
      const p = getPriceForSize(item, sz);
      priceEl.dataset.price = String(p);
      priceEl.textContent = '‚Çπ ' + p;
    }
    sizeSelect.value = baseSize;
    sizeSelect.addEventListener('change', (e)=> updatePriceDisplayForSize(e.target.value));

    // add to cart event with debounce + click counts + style update
    const addBtn = card.querySelector('.addBtn');
    addBtn.addEventListener('click', (ev)=>{
      const btn = ev.currentTarget;
      const btnId = btn.id; // e.g. add-KID001
      const productId = btn.dataset.id || item.id;

      // per-button debounce (prevent double rapid clicks)
      const now = Date.now();
      if(lastClickTimestamps[btnId] && (now - lastClickTimestamps[btnId] < 400)){
        // ignore rapid repeated click
        return;
      }
      lastClickTimestamps[btnId] = now;

      // increment in-memory per-product click count
      if(!cartClickCounts[productId]) cartClickCounts[productId] = 0;
      cartClickCounts[productId]++;

      // update button text and style
      btn.textContent = `Add to Cart (${cartClickCounts[productId]})`;
      btn.classList.add('clicked');

      // prepare product object using button data and selected size
      const selectedSize = sizeSelect.value || baseSize;
      const selectedPrice = getPriceForSize(item, selectedSize);

      const productObj = {
        id: productId,
        name: btn.dataset.name || item.name,
        size: selectedSize,
        price: Number(selectedPrice),
        image: btn.dataset.image || item.image || '',
        desc: btn.dataset.desc || item.desc || ''
      };

      // add to cart (stores full details)
      addToCart(productObj);

      // small toast
      showToast(`${productObj.name} (${productObj.size}) added to cart`);
    });

    // wishlist button
    const wbtn = card.querySelector('.wishlistBtn');
    wbtn.addEventListener('click', ()=>{
      const selectedSize = sizeSelect.value || baseSize;
      const productObj = {
        id: item.id, name: item.name, size: selectedSize, price: getPriceForSize(item, selectedSize), image: item.image, desc: item.desc
      };
      toggleWishlist(productObj);
    });

    // initialize button text if previously clicked in this session
    const existingCount = cartClickCounts[item.id] || 0;
    if(existingCount){
      const btn = card.querySelector('.addBtn');
      btn.textContent = `Add to Cart (${existingCount})`;
      if(existingCount > 0) btn.classList.add('clicked');
    }
  }

  /* Build Most Sold grid (KID IDs provided) */
  function renderMostSold(){
    mostSoldGrid.innerHTML = '';
    const ids = MOST_SOLD_IDS;
    ids.forEach(id => {
      const item = allItems.find(x=>x.id === id);
      if(!item) return;
      // reuse compact card structure (detailed card as requested)
      const col = document.createElement('div');
      col.className = 'card';
      const imgSrc = resolveImage(item.image);
      col.innerHTML = `
        <img src="${imgSrc}" alt="${escapeHtml(item.name)}" loading="lazy" onerror="this.onerror=null;this.src='${BASE_URL}images/placeholder.png'"/>
        <h4>${escapeHtml(item.name)}</h4>
        <div class="small">Age: ${escapeHtml(item.ageRange||'')}</div>
        <div class="price">‚Çπ ${getPriceForSize(item, getSizesForItem(item)[0])}</div>
        <div class="small" style="margin-top:6px">${escapeHtml(item.desc||'')}</div>
        <div class="card-controls">
          <div>
            <label class="small">Size:
              <select class="sizeSelectSmall" aria-label="Select size"></select>
            </label>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button class="btn addBtnSmall" type="button" data-id="${escapeHtml(item.id)}">Add to Cart</button>
          </div>
        </div>
      `;
      mostSoldGrid.appendChild(col);

      // populate sizes
      const sizeSelect = col.querySelector('.sizeSelectSmall');
      const sizes = getSizesForItem(item);
      sizes.forEach(sz=>{
        const opt = document.createElement('option'); opt.value = sz; opt.text = sz; sizeSelect.appendChild(opt);
      });
      // add handler
      col.querySelector('.addBtnSmall').addEventListener('click', (e)=>{
        const id = e.currentTarget.getAttribute('data-id');
        const sel = sizeSelect.value || sizes[0];
        const price = getPriceForSize(item, sel);
        addToCart({ id: item.id, name: item.name, size: sel, price, image: item.image, desc: item.desc });
        showToast(`${item.name} (${sel}) added to cart`);
      });
    });
  }

  /* tiny toast feedback */
  function showToast(msg, ms = 900){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.position = 'fixed';
    t.style.right = '18px';
    t.style.bottom = '18px';
    t.style.padding = '8px 12px';
    t.style.background = '#111';
    t.style.color = '#fff';
    t.style.borderRadius = '8px';
    t.style.zIndex = 9999;
    t.style.opacity = '0';
    t.style.transition = 'opacity 0.18s';
    document.body.appendChild(t);
    requestAnimationFrame(()=> t.style.opacity = '1');
    setTimeout(()=>{ t.style.opacity = '0'; setTimeout(()=> t.remove(),200); }, ms);
  }

  /* ------------------------ Invoice ------------------------ */
  function nextInvoiceNumber(){
    invoiceSeq = (isNaN(invoiceSeq) ? 0 : invoiceSeq) + 1;
    localStorage.setItem('invoice_seq', String(invoiceSeq));
    return 'INV-' + String(invoiceSeq).padStart(4,'0');
  }

  function openInvoiceModal(invNo){
    const d = new Date();
    const dateStr = d.toLocaleString();
    let itemsHtml = '';
    let total = 0;
    cart.forEach((i, idx)=>{
      const sub = (Number(i.price)||0) * (i.qty||0);
      itemsHtml += `<tr><td style="width:40px">${idx+1}</td><td>${escapeHtml(i.name)}</td><td style="text-align:center">${escapeHtml(i.size)}</td><td style="text-align:right">‚Çπ ${i.price}</td><td style="text-align:right">‚Çπ ${sub}</td></tr>`;
      total += sub;
    });

    const invoiceHtml = `
      <div class="invoiceHeader">
        <div class="invoiceLogo">
          <img src="logo.png" alt="Kids Store Logo" style="width:100px;height:auto;">
          <div style="margin-top:4px">
            <div style="font-weight:700">Kids Clothing Store</div>
            <div class="small">Pune, India</div>
            <div class="small">GSTIN: XXYYYZZZ | Phone: +91 99999 99999</div>
          </div>
        </div>
        <div style="text-align:right">
          <div>Invoice #: <strong>${escapeHtml(invNo)}</strong></div>
          <div>Date: ${escapeHtml(dateStr)}</div>
        </div>
      </div>

      <table class="invoiceTable">
        <thead>
          <tr><th style="width:40px">#</th><th>Item</th><th class="center">Size</th><th class="right">Price</th><th class="right">Sub Total</th></tr>
        </thead>
        <tbody>
          ${itemsHtml}
        </tbody>
        <tfoot>
          <tr><td colspan="4" style="text-align:right;font-weight:700">Total</td><td style="text-align:right;font-weight:700">‚Çπ ${total}</td></tr>
        </tfoot>
      </table>

      <div style="margin-top:14px;font-size:13px;color:#555">
        <div>Thank you for your purchase!</div>
        <div style="margin-top:8px">This is a system-generated invoice.</div>
      </div>

      <div style="margin-top:18px;display:flex;justify-content:space-between;align-items:center">
        <div class="small">Powered by Kids Store</div>
        <div><img src="logo.png" alt="logo" style="width:60px;height:auto;opacity:0.6"></div>
      </div>
    `;

    const invoiceContent = document.getElementById('invoiceContent');
    invoiceContent.innerHTML = invoiceHtml;
    const invoiceOverlay = document.getElementById('invoiceModalOverlay');
    invoiceOverlay.style.display = 'flex';
    invoiceOverlay.setAttribute('aria-hidden','false');
  }

  /* print handler */
  document.getElementById('printInvoice')?.addEventListener('click', ()=>{ window.print(); });

  /* ------------------------ Load data and initialize ------------------------ */
  (async function init(){
    try {
      const resp = await fetch(JSON_FILE);
      if(!resp.ok) throw new Error('Failed to fetch ' + JSON_FILE + ': ' + resp.status);
      const data = await resp.json();
      if(Array.isArray(data)) allItems = data;
      else if(typeof data === 'object') {
        allItems = [];
        Object.values(data).forEach(v => { if(Array.isArray(v)) allItems = allItems.concat(v); });
      } else allItems = [];

      // render most sold
      renderMostSold();

      // apply filters and show initial products
      applyFiltersAndSort(true);

      // render cart & wishlist from storage
      renderCart();
      renderWishlist();
      updateHeaderCartCount();

    } catch(err){
      document.getElementById('sectionsContainer').innerHTML = `<div style="color:#c00;padding:20px">Error loading ${JSON_FILE}: ${escapeHtml(err.message)}</div>`;
      console.error(err);
    }
  })();

  /* Filtering, sorting, pagination */
  function applyFiltersAndSort(resetShown){
    const q = (searchInput.value||'').trim().toLowerCase();
    filtered = allItems.filter(i=>{
      if(!q) return true;
      return String(i.name||'').toLowerCase().includes(q) || String(i.desc||'').toLowerCase().includes(q);
    });
    const sortBy = sortBySelect.value;
    filtered.sort((a,b)=>{
      if(sortBy === 'price'){
        const pa = getPriceForSize(a, getSizesForItem(a)[0]);
        const pb = getPriceForSize(b, getSizesForItem(b)[0]);
        return pa - pb;
      }
      return String(a.name||'').localeCompare(String(b.name||''), undefined, {sensitivity:'base'});
    });
    if(resetShown){
      shownCount = 0;
      Object.values(sectionMap).forEach(s=>{ s.grid.innerHTML = ''; s.body.classList.add('hidden'); s.header.querySelector('.toggleSign').textContent = '+'; });
    }
    renderNextPage();
  }

  function renderNextPage(){
    pageSize = parseInt(pageSizeSelect.value,10) || 10;
    const start = shownCount;
    const end = Math.min(shownCount + pageSize, filtered.length);
    const slice = filtered.slice(start, end);
    slice.forEach(item => renderCardIntoSection(item));
    shownCount = end;
    loadMoreBtn.style.display = (shownCount >= filtered.length) ? 'none' : 'inline-block';
  }

  /* ------------------------ UI events ------------------------ */
  loadMoreBtn.addEventListener('click', ()=> renderNextPage());
  pageSizeSelect.addEventListener('change', ()=> { applyFiltersAndSort(true); });
  searchInput.addEventListener('input', debounce(()=> { applyFiltersAndSort(true); }, 250));
  sortBySelect.addEventListener('change', ()=> { applyFiltersAndSort(true); });

  document.getElementById('menuHome').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0, behavior:'smooth'}); });
  document.getElementById('menuProducts').addEventListener('click', (e)=>{ e.preventDefault(); document.getElementById('productsTop').scrollIntoView({behavior:'smooth'}); });
  document.getElementById('menuContact').addEventListener('click', (e)=>{ e.preventDefault(); document.getElementById('contact').scrollIntoView({behavior:'smooth'}); });

  /* Cart modal controls */
  const cartModalOverlay = document.getElementById('cartModalOverlay');
  const closeCartBtn = document.getElementById('closeCartBtn');
  const modalClear = document.getElementById('modalClear');
  const modalCheckout = document.getElementById('modalCheckout');
  const invoiceBtn = document.getElementById('invoiceBtn');

  document.getElementById('menuCart').addEventListener('click', (e)=>{ e.preventDefault(); ShowCart(); });
  document.getElementById('headerCartBtn').addEventListener('click', (e)=>{ e.preventDefault(); ShowCart(); });

  function ShowCart(){
    renderCart();
    cartModalOverlay.style.display = 'flex';
    cartModalOverlay.setAttribute('aria-hidden','false');
  }
  function CloseCart(){
    cartModalOverlay.style.display = 'none';
    cartModalOverlay.setAttribute('aria-hidden','true');
  }
  closeCartBtn.addEventListener('click', CloseCart);
  cartModalOverlay.addEventListener('click', (e)=>{ if(e.target === cartModalOverlay) CloseCart(); });

  modalClear.addEventListener('click', ()=>{ if(confirm('Clear cart?')){ cart = []; saveCart(); } });

  /* invoice handlers */
  document.getElementById('invoiceBtn')?.addEventListener('click', ()=>{
    if(cart.length === 0){ alert('Cart is empty'); return; }
    const invNo = nextInvoiceNumber();
    openInvoiceModal(invNo);
  });

  modalCheckout.addEventListener('click', ()=>{
    if(cart.length === 0){ alert('Cart is empty'); return; }
    const invNo = nextInvoiceNumber();
    openInvoiceModal(invNo);
    if(confirm('Clear cart after checkout?')){ cart = []; saveCart(); CloseCart(); }
  });

  const invoiceOverlay = document.getElementById('invoiceModalOverlay');
  const closeInvoiceBtn = document.getElementById('closeInvoice');
  closeInvoiceBtn.addEventListener('click', ()=>{
    invoiceOverlay.style.display = 'none';
    invoiceOverlay.setAttribute('aria-hidden','true');
  });
  invoiceOverlay.addEventListener('click', (e)=>{ if(e.target === invoiceOverlay) { invoiceOverlay.style.display = 'none'; invoiceOverlay.setAttribute('aria-hidden','true'); } });

  /* wishlist handlers */
  const wishlistModalOverlay = document.getElementById('wishlistModalOverlay');
  const closeWishlistBtn = document.getElementById('closeWishlistBtn');
  document.getElementById('headerWishlistBtn').addEventListener('click', ()=>{
    renderWishlist();
    wishlistModalOverlay.style.display = 'flex';
    wishlistModalOverlay.setAttribute('aria-hidden','false');
  });
  closeWishlistBtn.addEventListener('click', ()=>{
    wishlistModalOverlay.style.display = 'none';
    wishlistModalOverlay.setAttribute('aria-hidden','true');
  });
  wishlistModalOverlay.addEventListener('click', (e)=>{ if(e.target === wishlistModalOverlay) { wishlistModalOverlay.style.display = 'none'; wishlistModalOverlay.setAttribute('aria-hidden','true'); } });

  /* initial render */
  renderCart();
  renderWishlist();
  updateHeaderCartCount();

  // expose some useful debug helpers if needed
  window._ks = { addToCart, cart, wishlist, saveCart, saveWishlist };

})();
</script>
</body>
</html>
